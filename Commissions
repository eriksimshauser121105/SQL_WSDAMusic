-- Create a Commission Payout column that displays each employeeâ€™s commission based on 15% of the sales transaction amount.

SELECT
	e.FirstName || ' ' || e.LastName as EmployeeFullName,
	sum(i.total) as TotalTransactionAmount,
	round((0.15 * sum(i.total)),2) as CommissionPayout,
	c.FirstName ||' ' || c.LastName as CustomerFullName
FROM
	Employee as e
INNER JOIN
	Customer as c
ON
	e.EmployeeId = c.SupportRepId
INNER JOIN
	Invoice as i
ON
	c.CustomerId = i.CustomerId
WHERE
	((strftime('%Y', InvoiceDate) = '2011') OR (strftime('%Y', InvoiceDate) = '2012')) AND (e.LastName = 'Peacock')
GROUP BY
	CustomerFullName
HAVING
	sum(i.total) > 100
